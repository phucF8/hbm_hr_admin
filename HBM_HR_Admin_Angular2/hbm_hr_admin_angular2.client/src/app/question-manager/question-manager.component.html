<div class="container" [formGroup]="parentGroup">
  <!-- <p>QUESTIONS</p>
  <pre>{{ parentGroup.value | json }}</pre>
  <div *ngIf="parentGroup?.get('questions') as questionsControl">
    Ki·ªÉu: {{ getControlType(questionsControl) }}
  </div> -->




  <button type="button" class="add-question-btn" (click)="addQuestion()">
    <span>+</span>
    Th√™m c√¢u h·ªèi
  </button>

  <div formArrayName="questions" class="questions-container" cdkDropList [cdkDropListData]="formArray.controls" (cdkDropListDropped)="drop($event)">
    <!-- Questions List -->
    <div class="question-card" [ngClass]="{ 'collapsed': question.value.collapsed }" 
    *ngFor="let question of formArray.controls; let i = index; trackBy: trackByQuestionId" 
    [formGroupName]="i"
    cdkDrag>
      <!-- Question Header -->
      <div class="question-header" >
        <button type="button" class="action-btn drag-handle" title="K√©o th·∫£ ƒë·ªÉ s·∫Øp x·∫øp" cdkDragHandle>
          ‚ãÆ‚ãÆ
        </button>
        <!-- <label class="option-label">{{ question.get('orderNumber')?.value }}.</label> -->
       
        <div class="question-content">
          <input type="text" 
          class="question-title" [formControlName]="'content'" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ c√¢u h·ªèi..." 
          [ngClass]="{ 'is-invalid': question.get('content')?.invalid && (question.get('content')?.touched || question.get('content')?.dirty) }" 
          >
          <div class="invalid-feedback" *ngIf="question.get('content')?.invalid && (question.get('content')?.touched || question.get('content')?.dirty)">
            <span *ngIf="question.get('content')?.errors?.['required']">Vui l√≤ng nh·∫≠p n·ªôi dung c√¢u h·ªèi.</span>
            <!-- Th√™m l·ªói kh√°c n·∫øu c√≥ -->
          </div>

          <!-- <input type="text" class="question-title" [value]="question.get('content')"
            placeholder="Nh·∫≠p ti√™u ƒë·ªÅ c√¢u h·ªèi..."> -->


        </div>

        <select class="question-type-select" formControlName="type">
          <option value="SingleChoice">Ch·ªçn m·ªôt</option>
          <option value="MultiChoice">Ch·ªçn nhi·ªÅu</option>
          <option value="Essay">T·ª± lu·∫≠n</option>
        </select>

        <div class="question-actions">
          <button type="button" class="action-btn collapse-btn" (click)="toggleCollapse(i)" title="Thu g·ªçn/M·ªü r·ªông"
            *ngIf="question.get('type')?.value !== 'Essay'">
            {{ question.get('collapsed')?.value ? '‚ñº' : '‚ñ≤' }}
          </button>

          <button type="button" class="action-btn delete-btn" (click)="removeQuestion(i)" title="X√≥a c√¢u h·ªèi">
            üóëÔ∏è
          </button>
        </div>

      </div>

      <!-- Options Container -->
      <div class="options-container" *ngIf="question.get('type')?.value !== 'Essay'">
        <div class="options-header">
          <div class="options-title">C√°c l·ª±a ch·ªçn</div>
          <button type="button" class="add-option-btn" (click)="addOption(i)">
            <span>+</span>
            Th√™m l·ª±a ch·ªçn
          </button>
        </div>
        <!-- Options List -->
        <div formArrayName="options" cdkDropList [cdkDropListData]="getOptions(question).controls" (cdkDropListDropped)="dropOption($event, i)">
          <div class="option-item"
            *ngFor="let option of getOptions(question).controls; let j = index; trackBy: trackByOptionIndex"
            [formGroupName]="j" cdkDrag>
            <button type="button" class="drag-handle" cdkDragHandle title="K√©o ƒë·ªÉ s·∫Øp x·∫øp">
              ‚ãÆ‚ãÆ
            </button>
            <!-- <label class="option-label">{{ option.get('orderNumber')?.value }}.</label> -->
            <input type="text" class="option-input" formControlName="content" placeholder="Nh·∫≠p n·ªôi dung l·ª±a ch·ªçn..."
            [ngClass]="{ 'is-invalid': option.get('content')?.invalid && (option.get('content')?.touched || option.get('content')?.dirty) }" 
            >
            <div class="invalid-feedback" *ngIf="option.get('content')?.invalid && (option.get('content')?.touched || option.get('content')?.dirty)">
              <span *ngIf="option.get('content')?.errors?.['required']">Vui l√≤ng nh·∫≠p n·ªôi dung l·ª±a ch·ªçn.</span>
              <!-- Th√™m l·ªói kh√°c n·∫øu c√≥ -->
            </div>
            <div class="option-actions">
              <button type="button" class="option-delete" (click)="deleteOption(i, j)" title="X√≥a l·ª±a ch·ªçn">
                ‚úï
              </button>
            </div>
          </div>


        </div>


      </div>
    </div>
  </div>
</div>